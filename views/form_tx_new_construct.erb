<%
 # wallets = wallets
url_path = request.env['PATH_INFO'].to_s
shelley_ep = "/sign-tx-shelley"
wid = params[:wid] if params[:wid]
%>
<script type="text/javascript">
  $(function() {

      $(function(){
          if($('#invalid_before_specified').prop("checked")) {
              $('#invalid_before').prop("disabled", false);
              $('#invalid_before_unit').prop("disabled", false);
          } else {
            $('#invalid_before').prop("disabled", true);
            $('#invalid_before_unit').prop("disabled", true);
          }
      });
      $('#invalid_before_specified').change(function(){
          if($('#invalid_before_specified').prop("checked")) {
              $('#invalid_before').prop("disabled", false);
              $('#invalid_before_unit').prop("disabled", false);
          } else {
            $('#invalid_before').prop("disabled", true);
            $('#invalid_before_unit').prop("disabled", true);
          }
      });

      $(function(){
          if($('#invalid_hereafter_specified').prop("checked")) {
              $('#invalid_hereafter').prop("disabled", false);
              $('#invalid_hereafter_unit').prop("disabled", false);
          } else {
            $('#invalid_hereafter').prop("disabled", true);
            $('#invalid_hereafter_unit').prop("disabled", true);
          }
      });
      $('#invalid_hereafter_specified').change(function(){
          if($('#invalid_hereafter_specified').prop("checked")) {
              $('#invalid_hereafter').prop("disabled", false);
              $('#invalid_hereafter_unit').prop("disabled", false);
          } else {
            $('#invalid_hereafter').prop("disabled", true);
            $('#invalid_hereafter_unit').prop("disabled", true);
          }
      });

      $(function(){
          if($('#metadata_check').prop("checked")) {
              $('#metadata_form').show();
          } else {
              $('#metadata_form').hide();
          }
      });
      $('#metadata_check').change(function(){
          if($('#metadata_check').prop("checked")) {
              $('#metadata_form').show();
          } else {
              $('#metadata_form').hide();
          }
      });

      $(function(){
          if($('#payments_check').prop("checked")) {
              $('#payments_form').show();
          } else {
              $('#payments_form').hide();
          }
      });
      $('#payments_check').change(function(){
          if($('#payments_check').prop("checked")) {
              $('#payments_form').show();
          } else {
              $('#payments_form').hide();
          }
      });

      $(function(){
          if($('#withdrawals_check').prop("checked")) {
              $('#withdrawals_form').show();
          } else {
              $('#withdrawals_form').hide();
          }
      });
      $('#withdrawals_check').change(function(){
          if($('#withdrawals_check').prop("checked")) {
              $('#withdrawals_form').show();
          } else {
              $('#withdrawals_form').hide();
          }
      });

      $(function(){
          if($('#delegations_check').prop("checked")) {
              $('#delegations_form').show();
          } else {
              $('#delegations_form').hide();
          }
      });
      $('#delegations_check').change(function(){
          if($('#delegations_check').prop("checked")) {
              $('#delegations_form').show();
          } else {
              $('#delegations_form').hide();
          }
      });

      $(function(){
          if($('#minting_check').prop("checked")) {
              $('#minting_form').show();
          } else {
              $('#minting_form').hide();
          }
      });
      $('#minting_check').change(function(){
          if($('#minting_check').prop("checked")) {
              $('#minting_form').show();
          } else {
              $('#minting_form').hide();
          }
      });

      $(function(){
          if($('#validity_interval_check').prop("checked")) {
              $('#validity_interval_form').show();
          } else {
              $('#validity_interval_form').hide();
          }
      });
      $('#validity_interval_check').change(function(){
          if($('#validity_interval_check').prop("checked")) {
              $('#validity_interval_form').show();
          } else {
              $('#validity_interval_form').hide();
          }
      });

      $(function() {
          if($('#delegation_action').val() == 'quit') {
              $('#pool_id').hide();
          } else {
              $('#pool_id').show();
          }
          $('#delegation_action').change(function(){
              if($('#delegation_action').val() == 'quit') {
                  $('#pool_id').hide();
              } else {
                  $('#pool_id').show();
              }
          });
      });
  });
</script>
<div class="list-group">
  <div class="list-group-item">
    Construct Transaction üõ†Ô∏è
    | <small><a href="<%= "/wallets/#{wid}" %>">
        go back to wallet
      </a></small>
  </div>
  <div class="list-group-item">

    <form action="<%= shelley_ep %>" method="POST">
      <div class="form-group">
        <label for="wid">Source Wallet</label>
        <select class="form-control" name="wid" id="wid">
          <% wallets.each do |w| %>
          <option <%= wid == w['id'] ? "selected" : "" %> value="<%= w['id'] %>">
            <%= "#{w['name']} [id: #{w['id']}, balance available: #{w['balance']['available']['quantity']}]" %>
          </option>
          <% end %>
        </select>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="checkbox" value=""
        id="payments_check" name="payments_check" <%= "checked" if params[:payments_check] %>>
        <label class="form-check-label" for="payments_check">
          Payments
        </label>
      </div>
      <div id="payments_form" style="display:none">
        <div class="form-group">
          <label for="address">Address</label>
          <input type="text" class="form-control" name="address" id="address"
            placeholder="Address" value="">
        </div>
        <%= render_amount_form_part(wallets.select{|w| w['id'] == wid }.first['balance'], value = nil) %>
        <%= render_assets_form_part(wallets.select{|w| w['id'] == wid }.first['assets']['available']) %>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="metadata_check"
          name="metadata_check" <%= "checked" if params[:metadata_check] %>>
        <label class="form-check-label" for="metadata_check">
          Metadata
        </label>
      </div>
      <div id="metadata_form" style="display:none">
        <%= render_metadata_form_part %>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="withdrawals_check"
          name="withdrawals_check" <%= "checked" if params[:withdrawals_check] %>>
        <label class="form-check-label" for="withdrawals_check">
          Withdrawals
        </label>
      </div>
      <div id="withdrawals_form" style="display:none">
        <%= render_withdrawal_form_part %>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="delegations_check"
          name="delegations_check" <%= "checked" if params[:delegations_check] %>>
        <label class="form-check-label" for="delegations_check">
          Delegations
        </label>
      </div>
      <div id="delegations_form" style="display:none">
        <div class="form-group">
          <select class="form-control" name="delegation_action" id="delegation_action">
            <option value="join">Join</option>
            <option value="quit">Quit</option>
          </select>
        </div>
        <div class="form-group">
          <input type="text" class="form-control" name="pool_id" id="pool_id"
            placeholder="Pool ID" value="">
        </div>
        <div class="form-group">
          <input type="text" class="form-control" name="stake_key_id" id="stake_key_id"
            placeholder="Stake key ID" value="">
            <small id="help" class="form-text text-muted">Example: 1852H. An individual segment within a derivation path.</small>
        </div>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="minting_check" disabled>
        <label class="form-check-label" for="minting_check">
          Minting
        </label>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" name="validity_interval_check"
          id="validity_interval_check" <%= "checked" if params[:validity_interval_check] %>>
        <label class="form-check-label" for="validity_interval_check">
          Validity interval
        </label>
      </div>
      <div id="validity_interval_form" style="display:none">
        <div class="form-inline">
          &nbsp;&nbsp;
          <input class="form-check-input" type="checkbox" value=""
            name="invalid_before_specified"
            id="invalid_before_specified"
            <%= "checked" if params[:invalid_before_specified] %>>
          <input type="text" class="form-control" name="invalid_before" id="invalid_before"
            placeholder="Invalid Before" value="">

          <select class="form-control" name="invalid_before_unit" id="invalid_before_unit">
            <option value="second">second</option>
            <option value="slot">slot</option>
          </select>
        </div>
        <br/>
        <div class="form-inline">
          &nbsp;&nbsp;
          <input class="form-check-input" type="checkbox" value=""
            name="invalid_hereafter_specified"
            id="invalid_hereafter_specified"
            <%= "checked" if params[:invalid_hereafter_specified] %>>
          <input type="text" class="form-control" name="invalid_hereafter" id="invalid_hereafter"
            placeholder="Invalid Hereafter" value="">

          <select class="form-control" name="invalid_hereafter_unit" id="invalid_hereafter_unit">
            <option value="second">second</option>
            <option value="slot">slot</option>
          </select>
        </div>
        <br/>

      </div>
      <br/>
      <button type="submit" class="btn btn-success">Construct</button>

    </form>
  </div>
</div>
